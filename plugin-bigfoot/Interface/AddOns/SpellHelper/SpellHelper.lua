 SpellHelper_Stack = {}; SPELL_HELPER_MAX_BUTTONS = 7; if (GetLocale() == "zhCN") then MOD_SPELLHELPER_TITLE = {"法术助手", "fashuzhushou"}; SPELLHELPER_SHOW_NEW_SPELL = "便捷显示新学法术"; elseif (GetLocale() == "zhTW") then MOD_SPELLHELPER_TITLE = {"法術助手", "fashuzhushou"}; SPELLHELPER_SHOW_NEW_SPELL = "便捷顯示新學法術"; else MOD_SPELLHELPER_TITLE = "Spell Helper"; SPELLHELPER_SHOW_NEW_SPELL = "Show new spell easily"; end function SpellHelper_OnLoad() if GetLocale()=='zhCN' then ModManagement_RegisterMod( "SpellHelper", "Interface\\Icons\\INV_Gizmo_06", MOD_SPELLHELPER_TITLE, "", nil, nil, {[7]=true} ); ModManagement_RegisterCheckBox( "SpellHelper", SPELLHELPER_SHOW_NEW_SPELL, nil, "DisableQuestFading", 1, SpellHelperButton_ToggleShowNewSpell ); end end function SpellHelperButton_ToggleShowNewSpell(SpellHelper_7739b813d90aed43ab9d0eb84ec1c1ae) if SpellHelper_7739b813d90aed43ab9d0eb84ec1c1ae == 1 then if UnitLevel("player")==MAX_PLAYER_LEVEL_TABLE[GetAccountExpansionLevel()] and GetNumTalentGroups()==2 then BigFootSpells_UnregisterNewSpellSink(BIGFOOT_SPELL_EVENT_NEW, "SpellHelperButton_Sink"); else BigFootSpells_RegisterNewSpellSink(BIGFOOT_SPELL_EVENT_NEW, "SpellHelperButton_Sink"); end else BigFootSpells_UnregisterNewSpellSink(BIGFOOT_SPELL_EVENT_NEW, "SpellHelperButton_Sink"); end end function SpellHelperButton_OnClick(self, button, SpellHelper_84a073da3818b29cea0eff3d438fb356) local SpellHelper_a44ecbf575d7f2eca081a0592e8d84fa = self.info; local SpellHelper_8983c60d66c8593ec7165ea9dbedb584 = SpellHelper_a44ecbf575d7f2eca081a0592e8d84fa["name"]; local SpellHelper_776cc2335c5e051bd62524696424f056 = SpellHelper_a44ecbf575d7f2eca081a0592e8d84fa["rank"]; local SpellHelper_8d0febf2348ea712b2b375ae95601d5f = BigFootSpell_GetSpellInfo(SpellHelper_8983c60d66c8593ec7165ea9dbedb584, SpellHelper_776cc2335c5e051bd62524696424f056); if (not SpellHelper_8d0febf2348ea712b2b375ae95601d5f) then SpellHelperButton_Clear(self); end self:SetChecked("false"); if (button == "RightButton") then elseif ( SpellHelper_84a073da3818b29cea0eff3d438fb356 ) then PickupSpell(SpellHelper_8d0febf2348ea712b2b375ae95601d5f, SpellHelper_a44ecbf575d7f2eca081a0592e8d84fa["type"]); end local SpellHelper_4df1eb7ad5239e252fc1275e00a63f95 = getglobal(self:GetName().."Flash"); self:Hide(); SpellHelper_4df1eb7ad5239e252fc1275e00a63f95:Hide(); self.info = nil; SpellHelperButton_UpdateButtons(); end function SpellHelperButton_Clear(SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5) SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5.info = ni; SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5:Hide(); local SpellHelper_4df1eb7ad5239e252fc1275e00a63f95 = getglobal(SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5:GetName().."Flash"); SpellHelper_4df1eb7ad5239e252fc1275e00a63f95:Hide(); SpellHelperButton_UpdateButtons(); end function SpellHelperButton_OnEnter(self) local SpellHelper_a44ecbf575d7f2eca081a0592e8d84fa = self.info; local SpellHelper_8983c60d66c8593ec7165ea9dbedb584 = SpellHelper_a44ecbf575d7f2eca081a0592e8d84fa["name"]; local SpellHelper_776cc2335c5e051bd62524696424f056 = SpellHelper_a44ecbf575d7f2eca081a0592e8d84fa["rank"]; local SpellHelper_8d0febf2348ea712b2b375ae95601d5f = BigFootSpell_GetSpellInfo(SpellHelper_8983c60d66c8593ec7165ea9dbedb584, SpellHelper_776cc2335c5e051bd62524696424f056); if (not SpellHelper_8d0febf2348ea712b2b375ae95601d5f) then SpellHelperButton_Clear(self); return; end GameTooltip:SetOwner(self, "ANCHOR_RIGHT"); if ( GameTooltip:SetSpell(SpellHelper_8d0febf2348ea712b2b375ae95601d5f, SpellHelper_a44ecbf575d7f2eca081a0592e8d84fa["type"]) ) then self.updateTooltip = TOOLTIP_UPDATE_TIME; else self.updateTooltip = nil; end end function SpellHelperButton_OnUpdate(self, elapsed) if ( not self.updateTooltip ) then return; end self.updateTooltip = self.updateTooltip - elapsed; if ( self.updateTooltip > 0 ) then return; end if ( GameTooltip:IsOwned(self) ) then SpellHelperButton_OnEnter(self); else self.updateTooltip = nil; end end function SpellHelperButton_OnLoad(self) self:RegisterForDrag("LeftButton"); self:RegisterForClicks("LeftButtonUp", "RightButtonUp"); end function SpellHelperButton_UpdateButtons() local SpellHelper_e914904fab9d05d3f54d52bfc31a0f3f; for SpellHelper_e914904fab9d05d3f54d52bfc31a0f3f = 1, SPELL_HELPER_MAX_BUTTONS, 1 do local SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5 = getglobal("SpellHelperButton"..SpellHelper_e914904fab9d05d3f54d52bfc31a0f3f); if (SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5) then if (not SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5:IsVisible()) then for SpellHelper_5e57ab95c762a48d9a126b104db1056f = SpellHelper_e914904fab9d05d3f54d52bfc31a0f3f + 1, SPELL_HELPER_MAX_BUTTONS, 1 do local SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e = getglobal("SpellHelperButton"..SpellHelper_5e57ab95c762a48d9a126b104db1056f); if (SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e and SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e:IsVisible()) then SpellHelper_81558e5c28bb86140062827cf1c3e6dc(SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5, SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e); end end end end end local SpellHelper_413bf9c15ce77baa8ebf1cda4cbf4887, SpellHelper_2361bab8b48b1041ad740bb561b21aee; for SpellHelper_413bf9c15ce77baa8ebf1cda4cbf4887, SpellHelper_2361bab8b48b1041ad740bb561b21aee in pairs(SpellHelper_Stack) do for SpellHelper_e914904fab9d05d3f54d52bfc31a0f3f = 1, SPELL_HELPER_MAX_BUTTONS, 1 do local SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5 = getglobal("SpellHelperButton"..SpellHelper_e914904fab9d05d3f54d52bfc31a0f3f); if (SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5 and SpellHelper_Stack[SpellHelper_413bf9c15ce77baa8ebf1cda4cbf4887] and not SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5:IsVisible()) then local SpellHelper_8983c60d66c8593ec7165ea9dbedb584 = SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5:GetName(); local SpellHelper_4e44fd8036657e840cc0df153c8b1051 = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."IconTexture"); local SpellHelper_c16b98982b8e28b0fce973935a9b648e = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."SpellName"); local SpellHelper_1d8ef007c6d6f522e7ae87a70d859605 = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."SubSpellName"); local SpellHelper_4df1eb7ad5239e252fc1275e00a63f95 = getglobal("SpellHelperButton"..SpellHelper_e914904fab9d05d3f54d52bfc31a0f3f.."Flash"); SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5.info = SpellHelper_2361bab8b48b1041ad740bb561b21aee; SpellHelper_4e44fd8036657e840cc0df153c8b1051:SetTexture(SpellHelper_2361bab8b48b1041ad740bb561b21aee["texture"]); SpellHelper_c16b98982b8e28b0fce973935a9b648e:SetText(SpellHelper_2361bab8b48b1041ad740bb561b21aee["name"]); SpellHelper_1d8ef007c6d6f522e7ae87a70d859605:SetText(SpellHelper_2361bab8b48b1041ad740bb561b21aee["rank"]); SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5:Show(); SpellHelper_4df1eb7ad5239e252fc1275e00a63f95:Show(); SpellHelper_Stack[SpellHelper_413bf9c15ce77baa8ebf1cda4cbf4887] = nil; end end end for SpellHelper_e914904fab9d05d3f54d52bfc31a0f3f = 1, SPELL_HELPER_MAX_BUTTONS, 1 do local SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5 = getglobal("SpellHelperButton"..SpellHelper_e914904fab9d05d3f54d52bfc31a0f3f); if (SpellHelper_99f3cf2c6f1fdfadb0fd4ab6e0843bf5:IsVisible()) then UIFrameFlash(SpellHelperFlashFrame, 0.5, 0.5, 30, nil); return; end end UIFrameFlashRemoveFrame(SpellHelperFlashFrame); end function SpellHelper_81558e5c28bb86140062827cf1c3e6dc(SpellHelper_ad8436a5e203286daabf6371f7d4bbf5, SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e) local SpellHelper_a44ecbf575d7f2eca081a0592e8d84fa = SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e.info; SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e.info = SpellHelper_ad8436a5e203286daabf6371f7d4bbf5.info; SpellHelper_ad8436a5e203286daabf6371f7d4bbf5.info = SpellHelper_a44ecbf575d7f2eca081a0592e8d84fa; if (SpellHelper_ad8436a5e203286daabf6371f7d4bbf5.info) then local SpellHelper_8983c60d66c8593ec7165ea9dbedb584 = SpellHelper_ad8436a5e203286daabf6371f7d4bbf5:GetName(); local SpellHelper_4e44fd8036657e840cc0df153c8b1051 = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."IconTexture"); local SpellHelper_c16b98982b8e28b0fce973935a9b648e = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."SpellName"); local SpellHelper_1d8ef007c6d6f522e7ae87a70d859605 = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."SubSpellName"); local SpellHelper_db2133a52c6009acb272f0c247dca2fe = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."Flash"); SpellHelper_4e44fd8036657e840cc0df153c8b1051:SetTexture(SpellHelper_ad8436a5e203286daabf6371f7d4bbf5.info["texture"]); SpellHelper_c16b98982b8e28b0fce973935a9b648e:SetText(SpellHelper_ad8436a5e203286daabf6371f7d4bbf5.info["name"]); SpellHelper_1d8ef007c6d6f522e7ae87a70d859605:SetText(SpellHelper_ad8436a5e203286daabf6371f7d4bbf5.info["rank"]); SpellHelper_ad8436a5e203286daabf6371f7d4bbf5:Show(); SpellHelper_db2133a52c6009acb272f0c247dca2fe:Show(); else local SpellHelper_8983c60d66c8593ec7165ea9dbedb584 = SpellHelper_ad8436a5e203286daabf6371f7d4bbf5:GetName(); local SpellHelper_db2133a52c6009acb272f0c247dca2fe = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."Flash"); SpellHelper_ad8436a5e203286daabf6371f7d4bbf5:Hide(); SpellHelper_db2133a52c6009acb272f0c247dca2fe:Hide(); end if (SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e.info) then local SpellHelper_8983c60d66c8593ec7165ea9dbedb584 = SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e:GetName(); local SpellHelper_4e44fd8036657e840cc0df153c8b1051 = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."IconTexture"); local SpellHelper_c16b98982b8e28b0fce973935a9b648e = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."SpellName"); local SpellHelper_1d8ef007c6d6f522e7ae87a70d859605 = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."SubSpellName"); local SpellHelper_fd8735840dcc909b9d05f1eef9541330 = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."Flash"); SpellHelper_4e44fd8036657e840cc0df153c8b1051:SetTexture(SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e.info["texture"]); SpellHelper_c16b98982b8e28b0fce973935a9b648e:SetText(SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e.info["name"]); SpellHelper_1d8ef007c6d6f522e7ae87a70d859605:SetText(SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e.info["rank"]); SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e:Show(); SpellHelper_fd8735840dcc909b9d05f1eef9541330:Show(); else local SpellHelper_8983c60d66c8593ec7165ea9dbedb584 = SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e:GetName(); local SpellHelper_fd8735840dcc909b9d05f1eef9541330 = getglobal(SpellHelper_8983c60d66c8593ec7165ea9dbedb584.."Flash"); SpellHelper_b3abf60b2e789016349d8a0c9ae9d78e:Hide(); SpellHelper_fd8735840dcc909b9d05f1eef9541330:Hide(); end end function SpellHelperButton_Sink(SpellHelper_8d0febf2348ea712b2b375ae95601d5f, SpellHelper_8983c60d66c8593ec7165ea9dbedb584, SpellHelper_776cc2335c5e051bd62524696424f056, SpellHelper_e78d229014c7a07be65fde4797b92c86, SpellHelper_6d5e7d83d8358745ae4dcf61d16bd1f3, SpellHelper_9248008bbb6d0ee7ce13f6ee45680051, SpellHelper_5d5d9cc67f5efcdd37d972956c5d9741, SpellHelper_c24b715949f3cd17a839cd64ac2bce7f, SpellHelper_61136d0fcb72bd11d172044127e2fdbc) if (SpellHelper_c24b715949f3cd17a839cd64ac2bce7f) then return; end local SpellHelper_b48c6d810781a0aaca7a1daf572bf0a2 = {}; local SpellHelper_413bf9c15ce77baa8ebf1cda4cbf4887; SpellHelper_413bf9c15ce77baa8ebf1cda4cbf4887 = SpellHelper_8983c60d66c8593ec7165ea9dbedb584; if (SpellHelper_776cc2335c5e051bd62524696424f056) then SpellHelper_413bf9c15ce77baa8ebf1cda4cbf4887 = SpellHelper_413bf9c15ce77baa8ebf1cda4cbf4887 .. SpellHelper_776cc2335c5e051bd62524696424f056; end SpellHelper_b48c6d810781a0aaca7a1daf572bf0a2["name"] = SpellHelper_8983c60d66c8593ec7165ea9dbedb584; SpellHelper_b48c6d810781a0aaca7a1daf572bf0a2["rank"] = SpellHelper_776cc2335c5e051bd62524696424f056; SpellHelper_b48c6d810781a0aaca7a1daf572bf0a2["type"] = SpellHelper_6d5e7d83d8358745ae4dcf61d16bd1f3; SpellHelper_b48c6d810781a0aaca7a1daf572bf0a2["texture"] = SpellHelper_9248008bbb6d0ee7ce13f6ee45680051; SpellHelper_Stack[SpellHelper_413bf9c15ce77baa8ebf1cda4cbf4887] = SpellHelper_b48c6d810781a0aaca7a1daf572bf0a2; SpellHelperButton_UpdateButtons(); end
