MiDKP=MiDKP or {} local M = MiDKP string.twodigitfloat = function(MiDKP_f4e13e8ecf20422833dd2d694a22bf40) if math.abs(MiDKP_f4e13e8ecf20422833dd2d694a22bf40)<0.01 then return 0 end return string.format("%d",MiDKP_f4e13e8ecf20422833dd2d694a22bf40*100)/100 end string.iequal = function(s1,s2) return s1:upper() == s2:upper() end table.copy = function(object) local lookup_table = {} local function _copy(object) if type(object) ~= "table" then return object elseif lookup_table[object] then return lookup_table[object] end local new_table = {} lookup_table[object] = new_table for index, value in pairs(object) do new_table[_copy(index)] = _copy(value) end return setmetatable(new_table, getmetatable(object)) end return _copy(object) end table.append = function (t1,t2) if not t2 then return end for _,_v in pairs(t2) do table.insert(t1,_v) end end M.U={} function M.U:Init() if M.Debug then DEFAULT_CHAT_FRAME:SetMaxResize(600,1000) DEFAULT_CHAT_FRAME:SetMaxLines(2000) end M.U:Debug("Util Class Inited") M.U.LOOT_ITEM = self:String2Pattern(LOOT_ITEM) M.U.LOOT_ITEM_MULTIPLE = self:String2Pattern(LOOT_ITEM_MULTIPLE) M.U.LOOT_ITEM_SELF = self:String2Pattern(LOOT_ITEM_SELF) M.U.LOOT_ITEM_SELF_MULTIPLE = self:String2Pattern(LOOT_ITEM_SELF_MULTIPLE) M.U.LOOT_ITEM_PUSHED_SELF = self:String2Pattern(LOOT_ITEM_PUSHED_SELF) M.U.LOOT_ITEM_PUSHED_SELF_MULTIPLE = self:String2Pattern(LOOT_ITEM_PUSHED_SELF_MULTIPLE) end function M.U:PrintColor() DEFAULT_CHAT_FRAME:SetMaxLines(1000) local color ={"00","11","22","33","44","55","66","77","88","99","aa","bb","cc","dd","ee","ff"} count = 0 local s = "" for _i,_r in pairs(color) do for _j,_g in pairs(color) do for _i,_b in pairs(color) do s = s .."|cff".._r.._g.._b .."[".._r.._g.._b.."]|r" count = count + 1 if count % 8 ==0 then print(s) s = "" end end end end end function M.U:ParsePoint(point, noinfo) if (type(point) == "string") then if (not string.find(point, "^([%+%-%.0-9]+)$")) then if (not noinfo) then M.E:ThrowError("EDIT_INVALID_POINT") end return end point = tonumber(point) elseif (type(point) ~= "number") then return end return point end function M.U:SplitString(szFullString, szSeparator) local nFindStartIndex = 1 local nSplitIndex = 1 local nSplitArray = {} while true do local nFindLastIndex = string.find(szFullString, szSeparator, nFindStartIndex) if not nFindLastIndex then nSplitArray[nSplitIndex] = string.sub(szFullString, nFindStartIndex, string.len(szFullString)) break end nSplitArray[nSplitIndex] = string.sub(szFullString, nFindStartIndex, nFindLastIndex - 1) nFindStartIndex = nFindLastIndex + string.len(szSeparator) nSplitIndex = nSplitIndex + 1 end return nSplitArray end function M.U:String2Pattern(MiDKP_acd18e5e4cc047ed8d218397986e9dc2) MiDKP_acd18e5e4cc047ed8d218397986e9dc2 = string.gsub(MiDKP_acd18e5e4cc047ed8d218397986e9dc2, "%(", "%%(") MiDKP_acd18e5e4cc047ed8d218397986e9dc2 = string.gsub(MiDKP_acd18e5e4cc047ed8d218397986e9dc2, "%)", "%%)") MiDKP_acd18e5e4cc047ed8d218397986e9dc2 = string.gsub(MiDKP_acd18e5e4cc047ed8d218397986e9dc2, "%%s", "(.-)") MiDKP_acd18e5e4cc047ed8d218397986e9dc2 = string.gsub(MiDKP_acd18e5e4cc047ed8d218397986e9dc2, "%%d", "(%%d+)") return MiDKP_acd18e5e4cc047ed8d218397986e9dc2 end function M.U:GetTimeStamp() local _, month, day, year = CalendarGetDate() local hour,minute = GetGameTime() if not month or not day or not year or not hour or not minute then return end local t1,timevalue = pcall(function() return (year - 2000) * 60 * 60 * 365 + month * tonumber(string.format("%04d%02d%02d%02d%02d", year, month, day, hour, minute)) end) local t2,timestring = pcall(function()return string.format("%04d.%02d.%02d %02d:%02d", year, month, day, hour, minute)end) if t1 and t2 then return {timestring, timevalue} end return nil end function M.U:JoinString(tbl, sep) if (not sep) then sep = " " end local MiDKP_acd18e5e4cc047ed8d218397986e9dc2 = "" local i, MiDKP_8d0644c92128c1ff68223fd74ba63b56 if (tbl) then for i, MiDKP_8d0644c92128c1ff68223fd74ba63b56 in ipairs(tbl) do MiDKP_acd18e5e4cc047ed8d218397986e9dc2 = MiDKP_acd18e5e4cc047ed8d218397986e9dc2 .. MiDKP_8d0644c92128c1ff68223fd74ba63b56 .. sep end end if (string.len(MiDKP_acd18e5e4cc047ed8d218397986e9dc2) > 0) then return string.sub(MiDKP_acd18e5e4cc047ed8d218397986e9dc2, 1, string.len(MiDKP_acd18e5e4cc047ed8d218397986e9dc2) - string.len(sep)) end end function M.U:GetTimeString(interval) local day, hour, minute, second local ret = "" day = floor(interval/86400) interval = interval - day * 86400 hour = floor(interval/3600) interval = interval - hour * 3600 minute = floor(interval/60) interval = interval - minute * 60 second = floor(interval) if (day > 0) then ret = ret .. day .. MIDKP_TEXT_DAY end if (hour > 0) then ret = ret .. hour .. MIDKP_TEXT_HOUR end if (minute > 0) then ret = ret .. minute .. MIDKP_TEXT_MINUTE end if (second > 0) then ret = ret .. second .. MIDKP_TEXT_SECOND end return ret end function M.U:ParseHTMLText(MiDKP_e6955c64cf39bdb23dc86de1a9ec2117) MiDKP_e6955c64cf39bdb23dc86de1a9ec2117 = string.gsub(MiDKP_e6955c64cf39bdb23dc86de1a9ec2117, "<", "&lt;") MiDKP_e6955c64cf39bdb23dc86de1a9ec2117 = string.gsub(MiDKP_e6955c64cf39bdb23dc86de1a9ec2117, ">", "&gt;") MiDKP_e6955c64cf39bdb23dc86de1a9ec2117 = string.gsub(MiDKP_e6955c64cf39bdb23dc86de1a9ec2117, "|", "$") return MiDKP_e6955c64cf39bdb23dc86de1a9ec2117 end function M.U:FindString(MiDKP_acd18e5e4cc047ed8d218397986e9dc2, MiDKP_a8858383576d7634cceceaf04a2ddb29) local MiDKP_8e0e84596da5717799a875d1aeeb63bc=function(s, e, ...) if (s and e) then return ... end end return MiDKP_8e0e84596da5717799a875d1aeeb63bc(string.find(MiDKP_acd18e5e4cc047ed8d218397986e9dc2, MiDKP_a8858383576d7634cceceaf04a2ddb29)) end function M.U:FindItemLink(MiDKP_acd18e5e4cc047ed8d218397986e9dc2) local MiDKP_a2f3972c23a0aa3bd7fb0e9823d918f2,MiDKP_c2f245debd3efc045524792c222180d3,MiDKP_536473f22dedf9f29b94b1004a62b8a0 MiDKP_a2f3972c23a0aa3bd7fb0e9823d918f2,MiDKP_c2f245debd3efc045524792c222180d3,MiDKP_536473f22dedf9f29b94b1004a62b8a0= string.find(MiDKP_acd18e5e4cc047ed8d218397986e9dc2,"(|c%x+|Hitem:%d+:%-?%d+:%-?%d+:%-?%d+:%-?%d+:%-?%d+:%-?%d+:%-?%d+:%-?%d+|h%[.+%]|h|r).*") if(MiDKP_a2f3972c23a0aa3bd7fb0e9823d918f2 and MiDKP_c2f245debd3efc045524792c222180d3)then return MiDKP_536473f22dedf9f29b94b1004a62b8a0 end end function M.U:ParseItemLink(link) if (link) then for id, name in string.gmatch(link, "|c%x+|Hitem:(%d+):%-?%d+:%-?%d+:%-?%d+:%-?%d+:%-?%d+:%-?%d+:%-?%d+:%-?%d+|h%[(.+)%]|h|r") do return tonumber(id), name end end end function M.U:GetItemLink(arg1) local MiDKP_9c987de176f2b454baede402cee36bfa,MiDKP_e498578b78aa0db9c45f30f87d63debc,MiDKP_3f50417fb16be9b1078eb68d24fa9c26 if (not MiDKP_e498578b78aa0db9c45f30f87d63debc) then MiDKP_9c987de176f2b454baede402cee36bfa, MiDKP_e498578b78aa0db9c45f30f87d63debc, MiDKP_3f50417fb16be9b1078eb68d24fa9c26 = self:FindString(arg1, M.U.LOOT_ITEM_MULTIPLE) end if (not MiDKP_e498578b78aa0db9c45f30f87d63debc) then MiDKP_9c987de176f2b454baede402cee36bfa, MiDKP_e498578b78aa0db9c45f30f87d63debc = self:FindString(arg1, M.U.LOOT_ITEM) end if (not MiDKP_e498578b78aa0db9c45f30f87d63debc) then MiDKP_e498578b78aa0db9c45f30f87d63debc, MiDKP_3f50417fb16be9b1078eb68d24fa9c26 = self:FindString(arg1, M.U.LOOT_ITEM_SELF_MULTIPLE) end if (not MiDKP_e498578b78aa0db9c45f30f87d63debc) then MiDKP_e498578b78aa0db9c45f30f87d63debc = self:FindString(arg1, M.U.LOOT_ITEM_SELF) end if (not MiDKP_e498578b78aa0db9c45f30f87d63debc) then MiDKP_e498578b78aa0db9c45f30f87d63debc = self:FindString(arg1, M.U.LOOT_ITEM_PUSHED_SELF) end if (not MiDKP_e498578b78aa0db9c45f30f87d63debc) then MiDKP_e498578b78aa0db9c45f30f87d63debc,MiDKP_3f50417fb16be9b1078eb68d24fa9c26 = self:FindString(arg1, M.U.LOOT_ITEM_PUSHED_SELF_MULTIPLE) end if (not MiDKP_9c987de176f2b454baede402cee36bfa or MiDKP_9c987de176f2b454baede402cee36bfa == M.L.YOU) then MiDKP_9c987de176f2b454baede402cee36bfa = UnitName("player") end if (not MiDKP_e498578b78aa0db9c45f30f87d63debc) then return end MiDKP_3f50417fb16be9b1078eb68d24fa9c26 = MiDKP_3f50417fb16be9b1078eb68d24fa9c26 or 1 return MiDKP_9c987de176f2b454baede402cee36bfa,MiDKP_e498578b78aa0db9c45f30f87d63debc,(MiDKP_3f50417fb16be9b1078eb68d24fa9c26 == 1 and MiDKP_e498578b78aa0db9c45f30f87d63debc) or MiDKP_e498578b78aa0db9c45f30f87d63debc.."x"..MiDKP_3f50417fb16be9b1078eb68d24fa9c26 end function M.U:Print(MiDKP_6d5e7d83d8358745ae4dcf61d16bd1f3, msg, ...) local message = string.format(msg, ...) local color = {} if (message) then message = M.L["MESSAGE_"..(string.upper(MiDKP_6d5e7d83d8358745ae4dcf61d16bd1f3) or "INFO")]..message end if (message) then DEFAULT_CHAT_FRAME:AddMessage(message, 1.0, 0.82, 0.0) end end function M.U:Debug(msg,...) if M.Debug then if type(msg) ~='table' and type(msg) ~='function' then self:Print('debug',msg,...) elseif type(msg) == 'table' then self:Dump(msg) end end end function M.U:Dump(...) local function isScalar(arg) if (type(arg) == "table" or type(arg) == "function" or type(arg) == "userdata") then return nil; else return true; end end local function getScalarValue(arg) if(type(arg)=='boolean') then if arg then return 'true' else return 'false' end elseif (not arg) then arg = "(nil)"; elseif (not isScalar(arg)) then arg = "("..type(arg)..")"; end return arg; end local function getIndent(lvl) local s = "" for _i = 0,lvl do s = s .. M.L.SPACE end return s end local function getPrintableValue(arg,level) if (type(arg) == "table" and level <3) then local string = "{\n"..getIndent(level); local seperator = ""; local key, value; for key, value in pairs(arg) do string = string .. seperator .. getPrintableValue(key,level+1) .. " = " .. getPrintableValue(value,level+1); seperator = ",\n"..getIndent(level); end string = string .. "\n"..getIndent(level - 1).."}"; return string; else return getScalarValue(arg); end end local args = {...}; local msg = "Table:\n"; for i = 1, getn(args), 1 do msg = msg .. getPrintableValue(args[i],0); end if (msg == "") then msg = "(empty)"; end print(msg); end function M.U:RenderText(text, color) if(not color) or (not text) or type(text)=='table' or type(color)=='table' then return "" end return "|"..color..text.."|r" end function M.U:Size(MiDKP_49ccc92cd1bef60d860c1c7f84aaab89) local MiDKP_3f50417fb16be9b1078eb68d24fa9c26 = 0 local MiDKP_63a9ce6f1eeac72ef41293b7d0303335, MiDKP_8d0644c92128c1ff68223fd74ba63b56 for MiDKP_63a9ce6f1eeac72ef41293b7d0303335, MiDKP_8d0644c92128c1ff68223fd74ba63b56 in ipairs(MiDKP_49ccc92cd1bef60d860c1c7f84aaab89) do MiDKP_3f50417fb16be9b1078eb68d24fa9c26 = MiDKP_3f50417fb16be9b1078eb68d24fa9c26 + 1 end if(MiDKP_3f50417fb16be9b1078eb68d24fa9c26==0)then for MiDKP_63a9ce6f1eeac72ef41293b7d0303335, MiDKP_8d0644c92128c1ff68223fd74ba63b56 in pairs(MiDKP_49ccc92cd1bef60d860c1c7f84aaab89) do MiDKP_3f50417fb16be9b1078eb68d24fa9c26 = MiDKP_3f50417fb16be9b1078eb68d24fa9c26 + 1 end end return MiDKP_3f50417fb16be9b1078eb68d24fa9c26 end function M.U:IsValidName(MiDKP_8983c60d66c8593ec7165ea9dbedb584) if string.find(MiDKP_8983c60d66c8593ec7165ea9dbedb584,"-") then return false elseif string.len(MiDKP_8983c60d66c8593ec7165ea9dbedb584)<2 then return false else return true end end function M.U:SafePopup_Show(MiDKP_8983c60d66c8593ec7165ea9dbedb584,...) if not UnitIsDeadOrGhost(UnitName("player")) then StaticPopup_Show(MiDKP_8983c60d66c8593ec7165ea9dbedb584,...) M.UI.Util:SetMainFrameEnable(false) else self:Print("error",M.L.DEAD) end end function M.U:AppendTable(t,t2) table.concat(t,t2) end function M.U:PlayerNameFormat(player) return ">"..player:GetName().."<" end function M.U:Whisper(member,msgList,hideReply) for _,_msg in pairs(msgList)do local id = _msg .. ":" .. member:GetName() if hideReply then MiDKP_HiddenWhisper[id] = true MiDKP_AFKDND[member:GetName()] = GetTime() end SendChatMessage(_msg, "WHISPER", nil, member:GetName()) end end function M.U:Send(msgList,channel) for _,_msg in pairs(msgList)do SendChatMessage(_msg,channel) end end M.U.DB = {} function M.U.DB:Load(id) local t = self[id] if not t then return nil end local entity = M.OO[t.type]:Load(t,id) return entity end 
